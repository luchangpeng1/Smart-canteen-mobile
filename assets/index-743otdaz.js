const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-vPOwo1tB.js","assets/vendor-qvz31vGP.js","assets/vendor-C6q9dLkW.css","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/Login-ChFe1MJ-.css","assets/Layout-BPbGztti.js","assets/Layout-BH7cjbYO.css","assets/Orders-CCFMtajL.js","assets/Orders-DAWyYFzz.css","assets/Menu-CBdbS_tl.js","assets/Menu-ntpiYaJv.css","assets/Stats-CUpcB0OM.js","assets/Stats-BfyS-_KS.css","assets/Withdraw-DG4SGWwF.js","assets/Withdraw-_gYMoCbI.css","assets/WithdrawHistory-B2Wg1EI2.js","assets/WithdrawHistory-B8rhhWLT.css","assets/OrderHistory-pRteJDZD.js","assets/OrderHistory-C7Jsyi8t.css","assets/TrafficMonitor-CKAApjFq.js","assets/TrafficMonitor-uOVwSQc3.css"])))=>i.map(i=>d[i]);
import{o as k,a as f,c as h,w as _,b as y,K as L,r as A,d as S,T as v,n as N,e as R,f as C,g as U,E,h as B,i as H,j as V,k as F,l as M,z as q}from"./vendor-qvz31vGP.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const x={__name:"App",setup(e){const t=()=>window.cordova||window.Capacitor;k(async()=>{t()&&(window.StatusBar&&(StatusBar.styleDefault(),StatusBar.backgroundColorByHexString("#ffffff")),window.CapApp&&CapApp.addListener("backButton",({canGoBack:s})=>{s?window.history.back():CapApp.exitApp()}),window.SplashScreen&&await SplashScreen.hide())});const r=s=>{s._scrollPosition=window.scrollY},n=s=>{s._scrollPosition&&N(()=>{window.scrollTo(0,s._scrollPosition)})},o=()=>{window.scrollTo(0,0)};return(s,a)=>{const i=R("router-view");return f(),h(i,null,{default:_(({Component:c})=>[y(v,{name:"fade",mode:"out-in",onBeforeLeave:r,onEnter:n,onAfterEnter:o},{default:_(()=>[(f(),h(L,null,[s.$route.meta.keepAlive?(f(),h(A(c),{key:0})):S("",!0)],1024))]),_:2},1024),y(v,{name:"fade",mode:"out-in"},{default:_(()=>[s.$route.meta.keepAlive?S("",!0):(f(),h(A(c),{key:0}))]),_:2},1024)]),_:1})}}},$="modulepreload",z=function(e){return"/Smart-canteen-mobile/"+e},g={},l=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(r.map(c=>{if(c=z(c),c in g)return;g[c]=!0;const m=c.endsWith(".css"),b=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${b}`))return;const u=document.createElement("link");if(u.rel=m?"stylesheet":$,m||(u.as="script"),u.crossOrigin="",u.href=c,i&&u.setAttribute("nonce",i),document.head.appendChild(u),m)return new Promise((O,D)=>{u.addEventListener("load",O),u.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return o.then(a=>{for(const i of a||[])i.status==="rejected"&&s(i.reason);return t().catch(s)})},K=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:()=>l(()=>import("./Login-vPOwo1tB.js"),__vite__mapDeps([0,1,2,3,4])),meta:{requiresAuth:!1}},{path:"/m/admin",component:()=>l(()=>import("./Layout-BPbGztti.js"),__vite__mapDeps([5,1,2,3,6])),meta:{requiresAuth:!0},children:[{path:"",redirect:"orders"},{path:"orders",name:"MobileAdminOrders",component:()=>l(()=>import("./Orders-CCFMtajL.js"),__vite__mapDeps([7,1,2,3,8])),meta:{keepAlive:!0}},{path:"menu",name:"MobileAdminMenu",component:()=>l(()=>import("./Menu-CBdbS_tl.js"),__vite__mapDeps([9,1,2,3,10])),meta:{keepAlive:!0}},{path:"stats",name:"MobileAdminStats",component:()=>l(()=>import("./Stats-CUpcB0OM.js"),__vite__mapDeps([11,1,2,3,12])),meta:{keepAlive:!0}},{path:"withdraw",name:"AdminWithdraw",component:()=>l(()=>import("./Withdraw-DG4SGWwF.js"),__vite__mapDeps([13,1,2,3,14])),meta:{keepAlive:!0}},{path:"withdraw/history",name:"AdminWithdrawHistory",component:()=>l(()=>import("./WithdrawHistory-B2Wg1EI2.js"),__vite__mapDeps([15,1,2,3,16]))},{path:"order-history",component:()=>l(()=>import("./OrderHistory-pRteJDZD.js"),__vite__mapDeps([17,1,2,3,18])),meta:{title:"历史订单"}},{path:"traffic",name:"MobileTrafficMonitor",component:()=>l(()=>import("./TrafficMonitor-CKAApjFq.js"),__vite__mapDeps([19,1,2,3,20])),meta:{keepAlive:!0}}]},{path:"/:pathMatch(.*)*",redirect:"/login"}],I=C({history:U(),base:"/Smart-canteen-mobile/",routes:K});I.beforeEach(async(e,t,r)=>{const n=localStorage.getItem("token");if(e.meta.requiresAuth&&!n){r({path:"/login",query:{redirect:e.fullPath}});return}if(e.path==="/login"&&n){r("/m/admin/orders");return}if(e.path==="/"&&!n){r("/login");return}r()});const d={handle(e,t,r){var n;console.error("Error:",e),console.error("Component:",t),console.error("Info:",r);try{e.name==="NetworkError"?E.error("网络连接失败，请检查网络设置"):((n=e.response)==null?void 0:n.status)===401?(E.error("登录已过期，请重新登录"),I.push("/login")):E.error(e.message||"操作失败，请重试")}catch(o){console.error("Error in error handler:",o)}}},T={userInfo:{name:"张三",studentId:"2021001001",avatar:"",balance:99.5,points:100,favorites:12,feedbacks:0,pointsHistory:[],phone:"13800138000",email:"zhangsan@example.com"}},W={userInfo:e=>e.userInfo,userBalance:e=>e.userInfo.balance},j={SET_USER_INFO(e,t){e.userInfo=t},UPDATE_USER_INFO(e,t){e.userInfo={...e.userInfo,...t}},UPDATE_BALANCE(e,t){e.userInfo.balance=t},UPDATE_POINTS(e,t){e.userInfo.points=t},ADD_POINTS_HISTORY(e,t){e.userInfo.pointsHistory.unshift(t)},UPDATE_FEEDBACKS_COUNT(e,t){e.userInfo.feedbacks=t}},J={async updateUserInfo({commit:e},t){try{return await new Promise(r=>setTimeout(r,500)),e("UPDATE_USER_INFO",t),t}catch(r){throw d.handle(r),r}},async fetchUserInfo({commit:e}){try{const t=localStorage.getItem("userInfo"),r=t?JSON.parse(t):T.userInfo;return e("SET_USER_INFO",r),r}catch(t){throw d.handle(t),t}},async updateBalance({commit:e,state:t},r){try{const n=t.userInfo.balance+r;return e("UPDATE_BALANCE",n),n}catch(n){throw d.handle(n),n}},async exchangePoints({commit:e,state:t},{itemId:r,points:n}){try{if(t.userInfo.points<n)throw new Error("积分不足");const o=t.userInfo.points-n;return e("UPDATE_POINTS",o),e("ADD_POINTS_HISTORY",{id:Date.now(),type:"exchange",points:-n,description:"积分兑换",createTime:new Date().toISOString()}),!0}catch(o){throw d.handle(o),o}},async getPointsHistory({state:e}){try{return e.userInfo.pointsHistory||[{id:1,type:"earn",points:2,description:"完成订单",createTime:"2024-03-20T10:00:00Z"},{id:2,type:"earn",points:3,description:"评价订单",createTime:"2024-03-19T15:30:00Z"}]}catch(t){throw d.handle(t),t}},updateFeedbacksCount({commit:e},t){e("UPDATE_FEEDBACKS_COUNT",t)},async logout({commit:e}){try{return localStorage.removeItem("userInfo"),localStorage.removeItem("token"),e("SET_USER_INFO",{name:"",studentId:"",avatar:"",balance:0,points:0,favorites:0,feedbacks:0,pointsHistory:[],phone:"",email:""}),!0}catch(t){throw d.handle(t),t}}},Y={namespaced:!0,state:T,getters:W,mutations:j,actions:J},w=B({strict:!1,modules:{user:Y},plugins:[e=>{e.subscribeAction({error:(t,r,n)=>{console.error(`Error in action ${t.type}:`,n)}})}]});w.subscribe((e,t)=>{localStorage.setItem("vuex-state",JSON.stringify(t))});const P=localStorage.getItem("vuex-state");P&&w.replaceState(JSON.parse(P));const p=H(x),Z=V();for(const[e,t]of Object.entries(F))p.component(e,t);p.use(M,{locale:q});p.config.errorHandler=(e,t,r)=>{var n;(n=e.message)!=null&&n.includes("ResizeObserver")||d.handle(e,t,r)};window.onerror=(e,t,r,n,o)=>(e.includes("ResizeObserver")||d.handle(o||new Error(e)),!0);p.use(w);p.use(Z);p.use(I);p.mount("#app");export{I as r};
