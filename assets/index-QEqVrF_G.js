const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Login-C5BJmZV4.js","./vendor-qvz31vGP.js","./vendor-C6q9dLkW.css","./_plugin-vue_export-helper-DlAUqK2U.js","./Login-ChFe1MJ-.css","./Layout-BPbGztti.js","./Layout-BH7cjbYO.css","./Orders-CIS0QO4x.js","./Orders-DAWyYFzz.css","./Menu-CBdbS_tl.js","./Menu-ntpiYaJv.css","./Stats-CUpcB0OM.js","./Stats-BfyS-_KS.css","./Withdraw-DG4SGWwF.js","./Withdraw-_gYMoCbI.css","./WithdrawHistory-B2Wg1EI2.js","./WithdrawHistory-B8rhhWLT.css","./OrderHistory-pRteJDZD.js","./OrderHistory-C7Jsyi8t.css","./TrafficMonitor-lBYZXIka.js","./TrafficMonitor-uOVwSQc3.css"])))=>i.map(i=>d[i]);
import{o as L,a as E,c as w,w as I,b as S,K as R,r as g,d as P,T,n as N,e as C,f as U,g as B,E as y,h as H,i as V,j as F,k as M,l as q,z as x}from"./vendor-qvz31vGP.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const $={__name:"App",setup(e){const t=()=>window.cordova||window.Capacitor;L(async()=>{t()&&(window.StatusBar&&(StatusBar.styleDefault(),StatusBar.backgroundColorByHexString("#ffffff")),window.CapApp&&CapApp.addListener("backButton",({canGoBack:s})=>{s?window.history.back():CapApp.exitApp()}),window.SplashScreen&&await SplashScreen.hide())});const n=s=>{s._scrollPosition=window.scrollY},r=s=>{s._scrollPosition&&N(()=>{window.scrollTo(0,s._scrollPosition)})},o=()=>{window.scrollTo(0,0)};return(s,i)=>{const a=C("router-view");return E(),w(a,null,{default:I(({Component:p})=>[S(T,{name:"fade",mode:"out-in",onBeforeLeave:n,onEnter:r,onAfterEnter:o},{default:I(()=>[(E(),w(R,null,[s.$route.meta.keepAlive?(E(),w(g(p),{key:0})):P("",!0)],1024))]),_:2},1024),S(T,{name:"fade",mode:"out-in"},{default:I(()=>[s.$route.meta.keepAlive?P("",!0):(E(),w(g(p),{key:0}))]),_:2},1024)]),_:1})}}},z="modulepreload",K=function(e,t){return new URL(e,t).href},b={},l=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){const i=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),p=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(n.map(c=>{if(c=K(c,r),c in b)return;b[c]=!0;const f=c.endsWith(".css"),k=f?'[rel="stylesheet"]':"";if(!!r)for(let h=i.length-1;h>=0;h--){const _=i[h];if(_.href===c&&(!f||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${k}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":z,f||(u.as="script"),u.crossOrigin="",u.href=c,p&&u.setAttribute("nonce",p),document.head.appendChild(u),f)return new Promise((h,_)=>{u.addEventListener("load",h),u.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return o.then(i=>{for(const a of i||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})},W=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:()=>l(()=>import("./Login-C5BJmZV4.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),meta:{requiresAuth:!1}},{path:"/m/admin",component:()=>l(()=>import("./Layout-BPbGztti.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url),meta:{requiresAuth:!0},children:[{path:"",redirect:"orders"},{path:"orders",name:"MobileAdminOrders",component:()=>l(()=>import("./Orders-CIS0QO4x.js"),__vite__mapDeps([7,1,2,3,8]),import.meta.url),meta:{keepAlive:!0}},{path:"menu",name:"MobileAdminMenu",component:()=>l(()=>import("./Menu-CBdbS_tl.js"),__vite__mapDeps([9,1,2,3,10]),import.meta.url),meta:{keepAlive:!0}},{path:"stats",name:"MobileAdminStats",component:()=>l(()=>import("./Stats-CUpcB0OM.js"),__vite__mapDeps([11,1,2,3,12]),import.meta.url),meta:{keepAlive:!0}},{path:"withdraw",name:"AdminWithdraw",component:()=>l(()=>import("./Withdraw-DG4SGWwF.js"),__vite__mapDeps([13,1,2,3,14]),import.meta.url),meta:{keepAlive:!0}},{path:"withdraw/history",name:"AdminWithdrawHistory",component:()=>l(()=>import("./WithdrawHistory-B2Wg1EI2.js"),__vite__mapDeps([15,1,2,3,16]),import.meta.url)},{path:"order-history",component:()=>l(()=>import("./OrderHistory-pRteJDZD.js"),__vite__mapDeps([17,1,2,3,18]),import.meta.url),meta:{title:"历史订单"}},{path:"traffic",name:"MobileTrafficMonitor",component:()=>l(()=>import("./TrafficMonitor-lBYZXIka.js"),__vite__mapDeps([19,1,2,3,20]),import.meta.url),meta:{keepAlive:!0}}]},{path:"/:pathMatch(.*)*",redirect:"/login"}],A=U({history:B(),base:"/Smart-canteen-mobile/",routes:W});A.beforeEach((e,t,n)=>{const r=localStorage.getItem("token");if(e.meta.requiresAuth&&!r){n({path:"/login",query:{redirect:e.fullPath}});return}if(e.path==="/login"&&r){n("/m/admin/orders");return}n()});const m={handle(e,t,n){var r;console.error("Error:",e),console.error("Component:",t),console.error("Info:",n);try{e.name==="NetworkError"?y.error("网络连接失败，请检查网络设置"):((r=e.response)==null?void 0:r.status)===401?(y.error("登录已过期，请重新登录"),A.push("/login")):y.error(e.message||"操作失败，请重试")}catch(o){console.error("Error in error handler:",o)}}},D={userInfo:{name:"张三",studentId:"2021001001",avatar:"",balance:99.5,points:100,favorites:12,feedbacks:0,pointsHistory:[],phone:"13800138000",email:"zhangsan@example.com"}},j={userInfo:e=>e.userInfo,userBalance:e=>e.userInfo.balance},J={SET_USER_INFO(e,t){e.userInfo=t},UPDATE_USER_INFO(e,t){e.userInfo={...e.userInfo,...t}},UPDATE_BALANCE(e,t){e.userInfo.balance=t},UPDATE_POINTS(e,t){e.userInfo.points=t},ADD_POINTS_HISTORY(e,t){e.userInfo.pointsHistory.unshift(t)},UPDATE_FEEDBACKS_COUNT(e,t){e.userInfo.feedbacks=t}},Y={async updateUserInfo({commit:e},t){try{return await new Promise(n=>setTimeout(n,500)),e("UPDATE_USER_INFO",t),t}catch(n){throw m.handle(n),n}},async fetchUserInfo({commit:e}){try{const t=localStorage.getItem("userInfo"),n=t?JSON.parse(t):D.userInfo;return e("SET_USER_INFO",n),n}catch(t){throw m.handle(t),t}},async updateBalance({commit:e,state:t},n){try{const r=t.userInfo.balance+n;return e("UPDATE_BALANCE",r),r}catch(r){throw m.handle(r),r}},async exchangePoints({commit:e,state:t},{itemId:n,points:r}){try{if(t.userInfo.points<r)throw new Error("积分不足");const o=t.userInfo.points-r;return e("UPDATE_POINTS",o),e("ADD_POINTS_HISTORY",{id:Date.now(),type:"exchange",points:-r,description:"积分兑换",createTime:new Date().toISOString()}),!0}catch(o){throw m.handle(o),o}},async getPointsHistory({state:e}){try{return e.userInfo.pointsHistory||[{id:1,type:"earn",points:2,description:"完成订单",createTime:"2024-03-20T10:00:00Z"},{id:2,type:"earn",points:3,description:"评价订单",createTime:"2024-03-19T15:30:00Z"}]}catch(t){throw m.handle(t),t}},updateFeedbacksCount({commit:e},t){e("UPDATE_FEEDBACKS_COUNT",t)},async logout({commit:e}){try{return localStorage.removeItem("userInfo"),localStorage.removeItem("token"),e("SET_USER_INFO",{name:"",studentId:"",avatar:"",balance:0,points:0,favorites:0,feedbacks:0,pointsHistory:[],phone:"",email:""}),!0}catch(t){throw m.handle(t),t}}},Z={namespaced:!0,state:D,getters:j,mutations:J,actions:Y},v=H({strict:!1,modules:{user:Z},plugins:[e=>{e.subscribeAction({error:(t,n,r)=>{console.error(`Error in action ${t.type}:`,r)}})}]});v.subscribe((e,t)=>{localStorage.setItem("vuex-state",JSON.stringify(t))});const O=localStorage.getItem("vuex-state");O&&v.replaceState(JSON.parse(O));const d=V($),G=F();for(const[e,t]of Object.entries(M))d.component(e,t);d.use(q,{locale:x});d.config.errorHandler=(e,t,n)=>{var r;(r=e.message)!=null&&r.includes("ResizeObserver")||m.handle(e,t,n)};window.onerror=(e,t,n,r,o)=>(e.includes("ResizeObserver")||m.handle(o||new Error(e)),!0);d.use(v);d.use(G);d.use(A);d.mount("#app");export{A as r};
