var U=Object.defineProperty;var v=(t,e,r)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var u=(t,e,r)=>v(t,typeof e!="symbol"?e+"":e,r);import{af as y,ag as G,E as _,m as N,o as w,G as k,q as d,b as i,w as O,aa as b,e as D,a as S,t as c,N as x,O as H,M as B,D as A,y as F}from"./vendor-qvz31vGP.js";import{r as f}from"./index-LcF5q6rD.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const s=class s{static success(e=null,r=this.MESSAGE[this.CODE.SUCCESS],o=this.CODE.SUCCESS){return{code:o,message:r,data:e,success:!0,timestamp:new Date().getTime()}}static error(e=this.MESSAGE[this.CODE.FAIL],r=this.CODE.FAIL,o=null){return{code:r,message:e,data:o,success:!1,timestamp:new Date().getTime()}}static paramError(e=this.MESSAGE[this.CODE.PARAM_ERROR]){return this.error(e,this.CODE.PARAM_ERROR)}static serviceError(e=this.MESSAGE[this.CODE.SERVICE_ERROR]){return this.error(e,this.CODE.SERVICE_ERROR)}static unauthorized(e=this.MESSAGE[this.CODE.ADMIN_LOGIN_AUTH]){return this.error(e,this.CODE.ADMIN_LOGIN_AUTH)}static forbidden(e=this.MESSAGE[this.CODE.ADMIN_ACCESS_FORBIDDEN]){return this.error(e,this.CODE.ADMIN_ACCESS_FORBIDDEN)}static tokenExpired(e=this.MESSAGE[this.CODE.TOKEN_EXPIRED]){return this.error(e,this.CODE.TOKEN_EXPIRED)}static tokenInvalid(e=this.MESSAGE[this.CODE.TOKEN_INVALID]){return this.error(e,this.CODE.TOKEN_INVALID)}static getMessageByCode(e){return this.MESSAGE[e]||"未知错误"}};u(s,"CODE",{SUCCESS:200,FAIL:201,PARAM_ERROR:202,SERVICE_ERROR:203,DATA_ERROR:204,ILLEGAL_REQUEST:205,REPEAT_SUBMIT:206,DELETE_ERROR:207,ADMIN_ACCOUNT_EXIST_ERROR:301,ADMIN_CAPTCHA_CODE_ERROR:302,ADMIN_CAPTCHA_CODE_EXPIRED:303,ADMIN_CAPTCHA_CODE_NOT_FOUND:304,ADMIN_LOGIN_AUTH:305,ADMIN_ACCOUNT_NOT_EXIST_ERROR:306,ADMIN_ACCOUNT_ERROR:307,ADMIN_ACCOUNT_DISABLED_ERROR:308,ADMIN_ACCESS_FORBIDDEN:309,APP_LOGIN_AUTH:501,APP_LOGIN_PHONE_EMPTY:502,APP_LOGIN_CODE_EMPTY:503,APP_SEND_SMS_TOO_OFTEN:504,APP_LOGIN_CODE_EXPIRED:505,APP_LOGIN_CODE_ERROR:506,APP_ACCOUNT_DISABLED_ERROR:507,TOKEN_EXPIRED:601,TOKEN_INVALID:602}),u(s,"MESSAGE",{[s.CODE.SUCCESS]:"成功",[s.CODE.FAIL]:"失败",[s.CODE.PARAM_ERROR]:"参数不正确",[s.CODE.SERVICE_ERROR]:"服务异常",[s.CODE.DATA_ERROR]:"数据异常",[s.CODE.ILLEGAL_REQUEST]:"非法请求",[s.CODE.REPEAT_SUBMIT]:"重复提交",[s.CODE.DELETE_ERROR]:"请先删除子集",[s.CODE.ADMIN_ACCOUNT_EXIST_ERROR]:"账号已存在",[s.CODE.ADMIN_CAPTCHA_CODE_ERROR]:"验证码错误",[s.CODE.ADMIN_CAPTCHA_CODE_EXPIRED]:"验证码已过期",[s.CODE.ADMIN_CAPTCHA_CODE_NOT_FOUND]:"未输入验证码",[s.CODE.ADMIN_LOGIN_AUTH]:"未登录",[s.CODE.ADMIN_ACCOUNT_NOT_EXIST_ERROR]:"账号不存在",[s.CODE.ADMIN_ACCOUNT_ERROR]:"用户名或密码错误",[s.CODE.ADMIN_ACCOUNT_DISABLED_ERROR]:"该用户已被禁用",[s.CODE.ADMIN_ACCESS_FORBIDDEN]:"无访问权限",[s.CODE.APP_LOGIN_AUTH]:"未登录",[s.CODE.APP_LOGIN_PHONE_EMPTY]:"手机号码为空",[s.CODE.APP_LOGIN_CODE_EMPTY]:"验证码为空",[s.CODE.APP_SEND_SMS_TOO_OFTEN]:"验证码发送过于频繁",[s.CODE.APP_LOGIN_CODE_EXPIRED]:"验证码已过期",[s.CODE.APP_LOGIN_CODE_ERROR]:"验证码错误",[s.CODE.APP_ACCOUNT_DISABLED_ERROR]:"该用户已被禁用",[s.CODE.TOKEN_EXPIRED]:"token过期",[s.CODE.TOKEN_INVALID]:"token非法"});let C=s;const z=y("user",{state:()=>({token:localStorage.getItem("token")||"",userInfo:JSON.parse(localStorage.getItem("userInfo"))||null}),actions:{setToken(t){this.token=t,localStorage.setItem("token",t)},setUserInfo(t){this.userInfo=t,localStorage.setItem("userInfo",JSON.stringify(t))},clearUserInfo(){this.token="",this.userInfo=null,localStorage.removeItem("token"),localStorage.removeItem("userInfo")}}}),P=G.create({baseURL:void 0,timeout:15e3,withCredentials:!1,headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, Accept, Authorization"}});P.interceptors.request.use(t=>{const e=z();if(e.token&&(t.headers.Authorization=`Bearer ${e.token}`),t.method==="post"||t.method==="put"){const r={...t.data};Object.keys(r).forEach(o=>{(r[o]===null||r[o]===void 0||r[o]==="")&&delete r[o]}),t.data=r}return t},t=>Promise.reject(t));P.interceptors.response.use(t=>{const e=t.data;if(e.code===C.CODE.SUCCESS)return e;switch(e.code){case C.CODE.TOKEN_EXPIRED:case C.CODE.TOKEN_INVALID:f.push("/login");break;case C.CODE.ADMIN_LOGIN_AUTH:case C.CODE.APP_LOGIN_AUTH:f.push("/login");break;default:_.error(e.message||"操作失败")}return Promise.reject(e)},t=>{var e;if(console.error("请求错误详情:",(e=t.response)==null?void 0:e.data),console.error("完整错误信息:",t),t.response){const r=t.response.data;switch(t.response.status){case 400:_.error("请求参数错误: "+(r.message||r.error||""));break;case 500:_.error("服务器错误: "+(r.message||r.error||"内部错误")),console.error("详细错误:",r);break;default:_.error(r.message||r.error||"请求失败")}}else t.request?_.error("网络连接失败，请检查网络设置"):_.error("请求配置错误");return Promise.reject(t)});const V={class:"mobile-traffic-monitor"},K={class:"card-header"},j={class:"traffic-list"},Y={class:"status"},q={class:"count"},J={class:"level-tag"},Q={__name:"TrafficMonitor",setup(t){const e=N(null),r=N(null),o=N([{id:1,canteenName:"第一食堂",currentCount:150,capacity:300,updateTime:new Date},{id:2,canteenName:"第二食堂",currentCount:280,capacity:400,updateTime:new Date}]),l=a=>{const n=a.currentCount/a.capacity;return n<.5?{type:"success",label:"空闲",status:"success",class:"status-free"}:n<.8?{type:"warning",label:"较忙",status:"warning",class:"status-busy"}:{type:"danger",label:"拥挤",status:"exception",class:"status-crowded"}},R=()=>{if(!e.value)return;r.value=b(e.value);const a={title:{text:"今日客流量趋势",textStyle:{fontSize:14}},tooltip:{trigger:"axis"},xAxis:{type:"category",data:Array.from({length:24},(n,h)=>`${h}:00`),axisLabel:{fontSize:10}},yAxis:{type:"value",axisLabel:{fontSize:10}},series:o.value.map(n=>({name:n.canteenName,type:"line",smooth:!0,data:Array.from({length:24},()=>Math.floor(Math.random()*n.capacity))}))};r.value.setOption(a)},T=async()=>{try{o.value=o.value.map(a=>({...a,currentCount:Math.floor(Math.random()*a.capacity),updateTime:new Date})),R(),_.success("数据已更新")}catch(a){console.error("刷新数据失败:",a),_.error("刷新数据失败")}};let p=null;return w(()=>{R(),p=setInterval(T,5*60*1e3),window.addEventListener("resize",()=>{var a;(a=r.value)==null||a.resize()})}),k(()=>{var a;clearInterval(p),(a=r.value)==null||a.dispose(),window.removeEventListener("resize",()=>{var n;(n=r.value)==null||n.resize()})}),(a,n)=>{const h=D("Refresh"),M=D("el-icon"),m=D("el-button"),L=D("el-progress"),g=D("el-tag"),I=D("el-card");return S(),d("div",V,[i(I,{class:"traffic-card"},{header:O(()=>[c("div",K,[n[0]||(n[0]=c("span",null,"实时客流量",-1)),i(m,{type:"primary",link:"",onClick:T},{default:O(()=>[i(M,null,{default:O(()=>[i(h)]),_:1})]),_:1})])]),default:O(()=>[c("div",j,[(S(!0),d(x,null,H(o.value,E=>(S(),d("div",{key:E.id,class:"traffic-item"},[i(I,{"body-style":{padding:"10px"},class:B(["status-card",l(E).class])},{default:O(()=>[c("h4",null,A(E.canteenName),1),c("div",Y,[i(L,{percentage:Math.round(E.currentCount/E.capacity*100),status:l(E).status},null,8,["percentage","status"]),c("span",q,A(E.currentCount)+"/"+A(E.capacity),1)]),c("div",J,[i(g,{type:l(E).type,size:"small"},{default:O(()=>[F(A(l(E).label),1)]),_:2},1032,["type"])])]),_:2},1032,["class"])]))),128))])]),_:1}),i(I,{class:"chart-card"},{default:O(()=>[c("div",{class:"chart-container",ref_key:"chartRef",ref:e},null,512)]),_:1})])}}},te=X(Q,[["__scopeId","data-v-006ede52"]]);export{te as default};
