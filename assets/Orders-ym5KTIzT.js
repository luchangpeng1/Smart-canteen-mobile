import{m as _,S as J,U,V as ie,o as Ae,q as f,t as l,b as t,w as s,D as u,y as m,u as y,c as Y,d as b,E as p,W as B,n as ye,e as g,a as i,X as Pt,Y as de,Z as Et,_ as qt,$ as Ue,a0 as Oe,J as I,L as q,a1 as Lt,a2 as Rt,a3 as je,a4 as Ft,a5 as he,M as we,a6 as Be,a7 as Ie,v as He,a8 as Pe,a9 as Ee,F as Wt}from"./vendor-CrV3p34f.js";import{_ as Qt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Jt="/Smart-canteen-mobile/assets/%E5%8F%AE%E5%92%9A-C5IQiY7P.mp3",Xt={class:"mobile-orders"},Zt={class:"window-control"},Gt={class:"window-info"},Kt={class:"header-top"},ea={class:"canteen-name"},ta={class:"floor-info"},aa={class:"header-bottom"},la={class:"status-controls"},sa=["src"],na={key:1,class:"upload-placeholder"},oa={class:"time-periods-container"},ia={class:"time-pickers"},da={class:"dialog-footer"},ua={class:"tabs-wrapper"},ra={class:"history-entry"},ca={class:"search-filter-area"},ma={class:"search-bar"},pa={class:"filter-toolbar"},va={class:"toolbar-left"},fa={key:3,class:"price-range"},_a={class:"auto-accept-controls"},ga={class:"auto-accept-switch"},ya={class:"auto-accept-actions"},ha={class:"settings-content"},wa={class:"smart-adjust-wrapper"},ka={key:0,class:"hint-text"},ba={class:"drawer-footer"},Ta={key:0,class:"batch-toolbar"},xa={class:"selected-count"},Ca={class:"batch-actions"},Va={class:"stats-cards"},Ma={class:"stat-card"},Da={class:"stat-value"},Sa={class:"stat-card"},$a={class:"stat-value"},za={class:"stat-card"},Ya={class:"stat-value"},Na={class:"order-list"},Aa={class:"date-header"},Ua={class:"date-text"},Oa={class:"order-count"},ja={class:"order-card-header"},Ba={class:"order-basic-info"},Ia={class:"order-info"},Ha={class:"order-info-left"},Pa={class:"order-no"},Ea={key:0,class:"order-meta"},qa={class:"order-time"},La={class:"customer-info"},Ra={class:"order-no"},Fa={class:"order-items"},Wa={class:"items-header"},Qa={class:"order-items-grid"},Ja={key:0,class:"item-image"},Xa=["src","alt"],Za={class:"item-content"},Ga={class:"item-info"},Ka={class:"item-name"},el={key:0,class:"item-specs"},tl={class:"item-price-info"},al={class:"item-quantity"},ll={class:"item-price"},sl={class:"order-footer"},nl={class:"order-total"},ol={class:"total-info"},il={class:"total-price"},dl={key:0,class:"order-remark"},ul={class:"order-actions"},rl={class:"order-card-header"},cl={class:"order-basic-info"},ml={class:"order-info"},pl={class:"order-info-left"},vl={class:"order-no"},fl={key:1,class:"order-no"},_l={key:0,class:"order-meta"},gl={class:"order-time"},yl={class:"customer-info"},hl={class:"student-id"},wl={class:"order-items"},kl={class:"items-header"},bl={class:"order-items-grid"},Tl={key:0,class:"item-image"},xl=["src","alt"],Cl={class:"item-content"},Vl={class:"item-info"},Ml={class:"item-name"},Dl={key:0,class:"item-specs"},Sl={class:"item-price-info"},$l={class:"item-quantity"},zl={class:"item-price"},Yl={class:"order-footer"},Nl={class:"order-total"},Al={class:"total-info"},Ul={class:"total-price"},Ol={key:0,class:"order-remark"},jl={class:"order-actions"},Bl={class:"pagination-container"},Il={key:1,class:"load-more"},Hl={key:0},Pl={key:1},El={__name:"Orders",setup(ql){const ke=Wt(),N=_("pending"),h=_([]),w=_([]),L=_(!1),te=_(!1),qe=_(1),F=_(10),ae=_(0),R=_("");_(!1),_({diningType:"",dateRange:[]});const le=_({orderCount:0,revenue:0,avgTime:0}),T=_(""),S=_(""),V=_({min:null,max:null}),$=_([]),H=_(1),se=_(0),ne=_(!1),be=_("sound"),X=_(!1),z=_({timeRange:[new Date(2e3,1,1,8,0),new Date(2e3,1,1,20,0)],maxOrders:5,rejectConditions:[],maxOrderAmount:100}),ue=_(!1),Te=_(!1),xe=_(!1),Le=[{text:"最近一周",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,a]}},{text:"最近一月",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,a]}},{text:"本月",value:()=>{const a=new Date;return[new Date(a.getFullYear(),a.getMonth(),1),a]}}],Re=J(()=>!T.value||!S.value&&T.value!=="total"&&T.value!=="date"?h.value:h.value.filter(a=>{switch(T.value){case"date":if(!$.value||!$.value.length)return!0;const e=U(a.createTime).format("YYYY-MM-DD"),o=$.value[0],d=$.value[1];return e>=o&&e<=d;case"orderNo":return a.orderNo.toLowerCase().includes(S.value.toLowerCase());case"studentName":return a.studentName.includes(S.value);case"diningType":return a.diningType===S.value;case"total":const v=V.value.min??0,O=V.value.max??1/0;return a.total>=v&&a.total<=O;default:return!0}})),Ce=a=>a.reduce((e,o)=>e+o.quantity,0),Fe=()=>{le.value={orderCount:47,revenue:1268,avgTime:15}},We=a=>["待处理","进行中"].includes(a.status),re=Array(20).fill(null).map((a,e)=>{const d=["待处理","进行中","已完成"][Math.floor(e/7)],v=d==="待处理"?Math.floor(Math.random()*30):d==="进行中"?Math.floor(Math.random()*120)+30:Math.floor(Math.random()*24*60)+150,O=[{name:"红烧肉",price:15},{name:"宫保鸡丁",price:16},{name:"鱼香肉丝",price:14},{name:"麻婆豆腐",price:12},{name:"青椒肉丝",price:13},{name:"回锅肉",price:15},{name:"水煮肉片",price:18},{name:"糖醋里脊",price:16}],r=["常规份量","加量","微辣","特辣"],M=Math.floor(Math.random()*2)+1,j=O.sort(()=>Math.random()-.5).slice(0,M).map((x,C)=>({id:e*10+C*2+1,name:x.name,quantity:Math.floor(Math.random()*2)+1,price:x.price,specs:r[Math.floor(Math.random()*r.length)]}));j.push({id:e*10+M*2,name:"米饭",quantity:Math.floor(Math.random()*2)+1,price:2,specs:Math.random()>.5?"常规份量":"大份"});const W=j.reduce((x,C)=>x+C.price*C.quantity,0),Q=["不要辣","少放盐","打包带走","加饭","多放点青菜",""];return{id:String(e+1),orderNo:`DD${U().format("YYYYMMDD")}${String(e+1).padStart(3,"0")}`,status:d,createTime:U().subtract(v,"minute").valueOf(),studentName:["张三","李四","王五","赵六","钱七","孙八","周九","吴十"][Math.floor(Math.random()*8)],studentId:`2024${String(Math.floor(Math.random()*1e3)+1).padStart(4,"0")}`,diningType:Math.random()>.5?"堂食":"外带",items:j,total:W,isNew:d==="待处理"&&Math.random()>.7,remark:Q[Math.floor(Math.random()*Q.length)],expanded:!1}});re.sort((a,e)=>e.createTime-a.createTime);const P=async(a=!1)=>{if(!L.value)try{L.value=!0,a&&(qe.value=1,h.value=[],te.value=!1);const e={pending:"待处理",processing:"进行中",completed:"已完成"};let o=re.filter(r=>r.status===e[N.value]);if(R.value){const r=R.value.toLowerCase();o=o.filter(M=>M.orderNo.toLowerCase().includes(r)||M.studentName.toLowerCase().includes(r))}T.value&&(o=o.filter(r=>{switch(T.value){case"date":if(!$.value||!$.value.length)return!0;const M=U(r.createTime).format("YYYY-MM-DD"),j=$.value[0],W=$.value[1];return M>=j&&M<=W;case"orderNo":return r.orderNo.toLowerCase().includes(S.value.toLowerCase());case"studentName":return r.studentName.includes(S.value);case"diningType":return r.diningType===S.value;case"total":const Q=V.value.min??0,x=V.value.max??1/0;return r.total>=Q&&r.total<=x;default:return!0}}));const d=(H.value-1)*F.value,v=d+F.value,O=o.slice(d,v);h.value=O,se.value=o.length,te.value=v>=o.length}catch(e){console.error(e),p.error("获取订单列表失败")}finally{L.value=!1}},Qe=a=>{F.value=a,P(!0)},Je=a=>{H.value=a,P(!0)};ie(N,()=>{H.value=1,F.value=10,P(!0)});const Z=a=>U(a).format("HH:mm:ss"),Ve=a=>({待处理:"warning",进行:"primary",已完成:"success",已取消:"info"})[a]||"info",Xe=async a=>{try{await B.confirm("确定接受此订单吗？"),a.status="进行中",p.success("已接单")}catch{}},Ze=async a=>{try{const{value:e}=await B.prompt("请输入拒绝原因",{confirmButtonText:"确定",cancelButtonText:"取消"});e&&(a.status="已取消",p.success("已拒绝订单"))}catch{}},Ge=async a=>{try{await B.confirm("确定完成此订单吗？"),a.status="已完成",p.success("订单已完成")}catch{}},Ke=async()=>{try{await B.confirm(`确定接受选中的 ${w.value.length} 个订单吗？`),h.value.forEach(a=>{w.value.includes(a.id)&&(a.status="进行中")}),w.value=[],p.success("批量接单成功")}catch{}},et=async()=>{try{await B.confirm(`确定完成选中的 ${w.value.length} 个订单吗？`),h.value.forEach(a=>{w.value.includes(a.id)&&(a.status="已完成")}),w.value=[],p.success("批量完成订单成功")}catch{}},tt=()=>{setInterval(()=>{if(Math.random()>.3&&N.value==="pending"){const a={id:`new-${Date.now()}`,orderNo:`DD${U().format("YYYYMMDD")}${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,status:"待处理",createTime:Date.now(),items:[{id:1,name:"红烧肉",quantity:1,price:15},{id:2,name:"米饭",quantity:1,price:2}],total:17,isNew:!0};h.value.unshift(a),ae.value++,new Audio(Jt).play()}},5e5)};Ae(()=>{P(!0),tt(),Fe()}),ie(N,()=>{N.value==="pending"&&(ae.value=0)});const at=a=>{w.value=a},lt=()=>{T.value="",S.value="",$.value=[],V.value={min:null,max:null},H.value=1,P(!0)},st=()=>{"vibrate"in navigator&&navigator.vibrate(50)},nt=async(a,e)=>{try{await updateOrderStatus(a.id,e),new Audio(statusChangeSound).play(),st(),p.success("订单状态已更新")}catch{p.error("更新失败")}},Me=a=>{a.expanded||h.value.forEach(e=>{e.id!==a.id&&(e.expanded=!1)}),a.expanded=!a.expanded},ot=async a=>{if(!w.value.length){p.warning("请先选择订单");return}switch(a){case"print":await it();break;case"export":await dt();break;case"delete":await ut();break}},it=async()=>{try{const e=h.value.filter(d=>w.value.includes(d.id)).map(d=>`
      订单号：${d.orderNo}
      下单时间：${Z(d.createTime)}
      客户信息：${d.studentName} (${d.studentId})
      菜品明细：
      ${d.items.map(v=>`${v.name} x${v.quantity} ¥${v.price}`).join(`
`)}
      总计：¥${d.total}
      ----------------------------------------
    `).join(`
`),o=window.open("","_blank");o.document.write(`
      <pre style="font-family: monospace; padding: 20px;">
        ${e}
      </pre>
    `),o.print(),o.close(),p.success("批量打印成功")}catch{p.error("批量打印失败")}},dt=async()=>{try{const a=h.value.filter(v=>w.value.includes(v.id)),e=[["订单号","下单时间","客户姓名","学号","订单状态","用餐方式","总金额"].join(","),...a.map(v=>[v.orderNo,Z(v.createTime),v.studentName,v.studentId,v.status,v.diningType,v.total].join(","))].join(`
`),o=new Blob([e],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");d.href=URL.createObjectURL(o),d.download=`订单导出_${U().format("YYYYMMDD_HHmmss")}.csv`,d.click(),p.success("导出成功")}catch{p.error("导出失败")}},ut=async()=>{try{await B.confirm(`确定要删除选中的 ${w.value.length} 个订单吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),h.value=h.value.filter(a=>!w.value.includes(a.id)),w.value=[],p.success("批量删除成功")}catch(a){a!=="cancel"&&p.error("批量删除失败")}},rt=J(()=>{if(N.value!=="completed")return[];const a=h.value.reduce((e,o)=>{const d=U(o.createTime).format("YYYY-MM-DD");return e[d]||(e[d]=[]),e[d].push(o),e},{});return Object.entries(a).map(([e,o])=>({date:ct(e),orders:o.sort((d,v)=>v.createTime-d.createTime)})).sort((e,o)=>{const d=U(e.date,"YYYY年MM月DD日");return U(o.date,"YYYY年MM月DD日").diff(d)})}),ct=a=>{const e=U(a),o=U().startOf("day"),d=o.subtract(1,"day");return e.isSame(o,"day")?"今天":e.isSame(d,"day")?"昨天":e.format("YYYY年MM月DD日")},mt=()=>{S.value="",$.value=[],V.value={min:null,max:null},R.value="",P(!0)},G=()=>{if(T.value==="total"&&V.value.max&&V.value.min>V.value.max){p.warning("最小金额不能大于最大金额");return}H.value=1,P(!0)},De=a=>({红烧肉:"https://img.zcool.cn/community/01a9445d54c65da801211d53235317.jpg",宫保鸡丁:"https://img.zcool.cn/community/01f8c65d54c65da801211d532386f7.jpg",鱼香肉丝:"https://img.zcool.cn/community/0120465d54c65da801211d532343b4.jpg",麻婆豆腐:"https://img.zcool.cn/community/01c3c25d54c65da801211d5323cf41.jpg",青椒肉丝:"https://img.zcool.cn/community/01d9d95d54c65da801211d532358f4.jpg",回锅肉:"https://img.zcool.cn/community/01d2fd5d54c65da801211d53236875.jpg",水煮肉片:"https://img.zcool.cn/community/01b5fd5d54c65da801211d53234c67.jpg",糖醋里脊:"https://img.zcool.cn/community/01f9d65d54c65da801211d53237dc3.jpg"})[a]||"https://img.zcool.cn/community/01311f5d54c65da801211d53231984.jpg",Se=async a=>{try{const e=window.open("","_blank");e.document.write(`
      <pre style="font-family: monospace; padding: 20px;">
        订单号：${a.orderNo}
        下单时间：${Z(a.createTime)}
        客户信息：${a.studentName} (${a.studentId})
        
        菜品明细：
        ${a.items.map(o=>`${o.name} x${o.quantity} ¥${o.price}`).join(`
`)}
        
        总计：¥${a.total}
      </pre>
    `),e.print(),e.close(),p.success("打印成功")}catch(e){console.error(e),p.error("打印失败")}},pt=a=>{a?B.confirm("开启自动接单后，系统将按照设置的条件自动处理新订单。是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{vt()}).catch(()=>{ne.value=!1}):ft()},vt=()=>{p.success("自动接单已开启")},ft=()=>{p.info("自动接单已关闭")};J(()=>h.value.sort((a,e)=>a.priority!==e.priority?e.priority-a.priority:a.createTime-e.createTime)),J(()=>({avgProcessTime:calculateAvgProcessTime(h.value),peakHours:analyzePeakHours(h.value),popularDishes:analyzePopularDishes(h.value)})),ie(w,a=>{const e=a.length,o=h.value.length;ue.value=e===o&&o>0,Te.value=e>0&&e<o});const _t=async a=>{xe.value=!0;try{if(a)if(Re.value.length>=100)if(await B.confirm(`当前筛选条件下共有 ${se.value} 条数据，是否全部选择？`,"提示",{confirmButtonText:"全选",cancelButtonText:"仅选择当前页",type:"warning"})){const o=await gt();w.value=o.map(d=>d.id),p.success(`已选择全部 ${se.value} 条数据`)}else w.value=h.value.map(o=>o.id),p.success(`已选择当前页 ${h.value.length} 条数据`);else w.value=h.value.map(e=>e.id);else w.value=[]}catch(e){e!=="cancel"&&p.error("操作失败")}finally{xe.value=!1}},gt=async()=>{L.value=!0;try{return re.filter(e=>N.value==="pending"?e.status==="待处理":N.value==="processing"?e.status==="进行中":N.value==="completed"?e.status==="已完成":!0)}catch{return p.error("获取数据失败"),[]}finally{L.value=!1}},yt=()=>{T.value="",S.value="",$.value=[],V.value={min:null,max:null},R.value="",H.value=1,P(!0),p.success("筛选条件已重置")},ht=J(()=>!!(T.value||S.value||$.value&&$.value.length||V.value.min!==null||V.value.max!==null||R.value)),wt=async()=>{try{await new Promise(a=>setTimeout(a,500)),p.success("设置已保存"),X.value=!1}catch{p.error("保存设置失败")}},A=_({name:"大荤窗口",status:"open",canteen:{id:1,name:"中央食堂"},floor:1,operatingHours:"10:30-13:30, 16:30-19:00",type:"大荤窗口"}),ce=_(A.value.status==="open"),E=_(!1),k=_({canteenId:"",floor:"",name:"",image:"",address:"",operatingPeriods:[{startTime:new Date(2e3,0,1,10,30),endTime:new Date(2e3,0,1,13,30)}]}),me=[{id:"1",name:"中央食堂",floors:3},{id:"2",name:"沁园餐厅",floors:2},{id:"3",name:"馨园餐厅",floors:1},{id:"4",name:"仲园餐厅",floors:3},{id:"5",name:"雅园餐厅",floors:1},{id:"6",name:"F区服务点",floors:1},{id:"7",name:"A区服务点",floors:1}],kt=J(()=>{const a=me.find(e=>e.id===k.value.canteenId);return a?Array.from({length:a.floors},(e,o)=>o+1):[]});ie(()=>k.value.canteenId,a=>{const e=me.find(o=>o.id===a);e&&k.value.floor>e.floors&&(k.value.floor=1)});const bt=async a=>{try{await B.confirm(`确定要${a?"开始营业":"打烊"}吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:a?"success":"warning"}),A.value.status=a?"open":"closed",p.success(`已${a?"开始营业":"打烊"}`)}catch{ce.value=!a}},Tt=async a=>{if(a==="editWindow"){E.value=!0;const e=A.value.operatingHours.split(",").map(o=>{const[d,v]=o.trim().split("-"),[O,r]=d.split(":").map(Number),[M,j]=v.split(":").map(Number);return{startTime:new Date(2e3,0,1,O,r),endTime:new Date(2e3,0,1,M,j)}});k.value={canteenId:A.value.canteen.id,floor:A.value.floor,name:A.value.name,image:A.value.image,address:A.value.address,operatingPeriods:e}}else if(a==="logout")try{await B.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),localStorage.removeItem("token"),localStorage.removeItem("user"),ke.push("/login"),p.success("已退出登录")}catch{}},xt=()=>{E.value=!0,ye(()=>{const a=document.querySelector(".window-edit-form .el-select");a&&a.click()})},Ct=()=>{E.value=!0,ye(()=>{const a=document.querySelector('.window-edit-form input[placeholder="请输入窗口名称"]');a&&a.focus()})},Vt=()=>{E.value=!0,ye(()=>{const a=document.querySelector(".time-periods-container");a&&a.scrollIntoView({behavior:"smooth"})})},Mt=()=>{k.value.operatingPeriods.push({startTime:new Date(2e3,0,1,10,0),endTime:new Date(2e3,0,1,22,0)})},Dt=a=>{k.value.operatingPeriods.splice(a,1)},pe=_(""),St=a=>{pe.value=a.url,k.value.image=a.url},$t=()=>{const a=k.value.operatingPeriods;for(const e of a){if(!e.startTime||!e.endTime)return p.warning("请填写完整的营业时间"),!1;if(e.endTime<=e.startTime)return p.warning("结束时间必须晚于开始时间"),!1}for(let e=0;e<a.length;e++)for(let o=e+1;o<a.length;o++)if(a[e].startTime<=a[o].endTime&&a[e].endTime>=a[o].startTime||a[o].startTime<=a[e].endTime&&a[o].endTime>=a[e].startTime)return p.warning("营业时间段不能重叠"),!1;return!0},zt=async()=>{if($t())try{const a=k.value.operatingPeriods.map(o=>{const d=`${o.startTime.getHours().toString().padStart(2,"0")}:${o.startTime.getMinutes().toString().padStart(2,"0")}`,v=`${o.endTime.getHours().toString().padStart(2,"0")}:${o.endTime.getMinutes().toString().padStart(2,"0")}`;return`${d}-${v}`}).join(", "),e={...k.value,operatingHours:a};p.success("窗口信息更新成功"),E.value=!1,await $e()}catch{p.error("更新窗口信息失败")}},$e=async()=>{};return Ae(()=>{$e()}),(a,e)=>{const o=g("el-icon"),d=g("el-divider"),v=g("el-tag"),O=g("el-switch"),r=g("el-button"),M=g("el-dropdown-item"),j=g("el-dropdown-menu"),W=g("el-dropdown"),Q=g("el-upload"),x=g("el-form-item"),C=g("el-option"),K=g("el-select"),ve=g("el-input"),fe=g("el-time-picker"),ze=g("el-form"),Yt=g("el-dialog"),Nt=g("el-badge"),_e=g("el-tab-pane"),At=g("el-tabs"),Ut=g("el-date-picker"),oe=g("el-input-number"),ee=g("el-checkbox"),Ye=g("el-checkbox-group"),Ot=g("el-time-select"),jt=g("el-scrollbar"),Bt=g("el-drawer"),ge=g("el-col"),It=g("el-row"),Ne=g("el-card"),Ht=g("el-pagination");return i(),f("div",Xt,[l("div",Zt,[l("div",Gt,[l("div",Kt,[l("div",{class:"location-info clickable",onClick:xt},[t(o,null,{default:s(()=>[t(y(Pt))]),_:1}),l("span",ea,u(A.value.canteen.name),1),t(d,{direction:"vertical"}),l("span",ta,u(A.value.floor)+"层",1),t(o,{class:"edit-icon"},{default:s(()=>[t(y(de))]),_:1})]),l("div",{class:"operation-time clickable",onClick:Vt},[t(o,null,{default:s(()=>[t(y(Et))]),_:1}),l("span",null,u(A.value.operatingHours),1),t(o,{class:"edit-icon"},{default:s(()=>[t(y(de))]),_:1})])]),l("div",aa,[l("span",{class:"window-name clickable",onClick:Ct},[m(u(A.value.name)+" ",1),t(o,{class:"edit-icon"},{default:s(()=>[t(y(de))]),_:1})]),l("div",la,[t(v,{size:"small",type:A.value.status==="open"?"success":"danger"},{default:s(()=>[m(u(A.value.status==="open"?"营业中":"已打烊"),1)]),_:1},8,["type"]),t(O,{modelValue:ce.value,"onUpdate:modelValue":e[0]||(e[0]=n=>ce.value=n),"active-text":"营业","inactive-text":"打烊",onChange:bt,class:"status-switch",style:{"--el-switch-on-color":"#07c160","--el-switch-off-color":"rgba(0,0,0,0.25)"}},null,8,["modelValue"]),t(W,{onCommand:Tt,trigger:"click"},{dropdown:s(()=>[t(j,null,{default:s(()=>[t(M,{command:"editWindow"},{default:s(()=>[t(o,null,{default:s(()=>[t(y(de))]),_:1}),e[30]||(e[30]=m("编辑窗口 "))]),_:1}),t(M,{command:"logout"},{default:s(()=>[t(o,null,{default:s(()=>[t(y(qt))]),_:1}),e[31]||(e[31]=m("退出登录 "))]),_:1})]),_:1})]),default:s(()=>[t(r,{size:"small",type:"primary",plain:""},{default:s(()=>[t(o,null,{default:s(()=>[t(y(Ue))]),_:1})]),_:1})]),_:1})])])])]),t(Yt,{modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=n=>E.value=n),title:"编辑窗口信息",width:"90%",class:"window-edit-dialog","close-on-click-modal":!1},{footer:s(()=>[l("div",da,[t(r,{onClick:e[4]||(e[4]=n=>E.value=!1)},{default:s(()=>e[35]||(e[35]=[m("取消")])),_:1}),t(r,{type:"primary",onClick:zt},{default:s(()=>e[36]||(e[36]=[m("确定")])),_:1})])]),default:s(()=>[t(ze,{model:k.value,"label-width":"4.5em",class:"window-edit-form"},{default:s(()=>[t(x,{label:"图片"},{default:s(()=>[t(Q,{class:"window-image-uploader",action:"/api/upload","show-file-list":!1,"on-success":St},{default:s(()=>[pe.value?(i(),f("img",{key:0,src:pe.value,class:"window-image"},null,8,sa)):(i(),f("div",na,[t(o,{class:"window-uploader-icon"},{default:s(()=>[t(y(Oe))]),_:1}),e[32]||(e[32]=l("span",null,"点击上传图片",-1))]))]),_:1})]),_:1}),t(x,{label:"餐厅"},{default:s(()=>[t(K,{modelValue:k.value.canteenId,"onUpdate:modelValue":e[1]||(e[1]=n=>k.value.canteenId=n),placeholder:"请选择餐厅",class:"full-width-input"},{default:s(()=>[(i(),f(I,null,q(me,n=>t(C,{key:n.id,label:n.name,value:n.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"楼层"},{default:s(()=>[t(K,{modelValue:k.value.floor,"onUpdate:modelValue":e[2]||(e[2]=n=>k.value.floor=n),placeholder:"请选择楼层",class:"full-width-input",disabled:!k.value.canteenId},{default:s(()=>[(i(!0),f(I,null,q(kt.value,n=>(i(),Y(C,{key:n,label:`${n}层`,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(x,{label:"名称"},{default:s(()=>[t(ve,{modelValue:k.value.name,"onUpdate:modelValue":e[3]||(e[3]=n=>k.value.name=n),class:"full-width-input",placeholder:"请输入窗口名称"},null,8,["modelValue"])]),_:1}),t(x,{label:"时间"},{default:s(()=>[l("div",oa,[(i(!0),f(I,null,q(k.value.operatingPeriods,(n,c)=>(i(),f("div",{key:c,class:"time-period"},[l("div",ia,[t(fe,{modelValue:n.startTime,"onUpdate:modelValue":D=>n.startTime=D,format:"HH:mm",placeholder:"开始时间",clearable:!1,class:"time-picker"},null,8,["modelValue","onUpdate:modelValue"]),e[33]||(e[33]=l("span",{class:"time-separator"},"至",-1)),t(fe,{modelValue:n.endTime,"onUpdate:modelValue":D=>n.endTime=D,format:"HH:mm",placeholder:"结束时间",clearable:!1,class:"time-picker"},null,8,["modelValue","onUpdate:modelValue"])]),k.value.operatingPeriods.length>1?(i(),Y(r,{key:0,type:"danger",circle:"",size:"small",class:"delete-time-btn",onClick:D=>Dt(c)},{default:s(()=>[t(o,null,{default:s(()=>[t(y(Lt))]),_:1})]),_:2},1032,["onClick"])):b("",!0)]))),128)),k.value.operatingPeriods.length<3?(i(),Y(r,{key:0,type:"primary",link:"",size:"small",class:"add-time-btn",onClick:Mt},{default:s(()=>[t(o,null,{default:s(()=>[t(y(Oe))]),_:1}),e[34]||(e[34]=m("添加时间段 "))]),_:1})):b("",!0)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l("div",ua,[t(At,{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=n=>N.value=n),onTabChange:nt,class:"order-tabs"},{default:s(()=>[t(_e,{name:"pending"},{label:s(()=>[t(Nt,{value:ae.value,hidden:!ae.value},{default:s(()=>e[37]||(e[37]=[m(" 待处理 ")])),_:1},8,["value","hidden"])]),_:1}),t(_e,{label:"进行中",name:"processing"}),t(_e,{label:"已完成",name:"completed"})]),_:1},8,["modelValue"]),l("div",ra,[t(r,{type:"primary",link:"",onClick:e[7]||(e[7]=n=>y(ke).push("/m/admin/order-history"))},{default:s(()=>[t(o,null,{default:s(()=>[t(y(Rt))]),_:1}),e[38]||(e[38]=m(" 历史订单 "))]),_:1})])]),l("div",ca,[l("div",ma,[t(ve,{modelValue:R.value,"onUpdate:modelValue":e[8]||(e[8]=n=>R.value=n),placeholder:"搜索订单号/学生姓名",clearable:""},{prefix:s(()=>[t(o,null,{default:s(()=>[t(y(je))]),_:1})]),_:1},8,["modelValue"]),t(r,{type:"primary",onClick:lt},{default:s(()=>[t(o,null,{default:s(()=>[t(y(je))]),_:1}),e[39]||(e[39]=m(" 搜索 "))]),_:1})]),l("div",pa,[l("div",va,[t(K,{modelValue:T.value,"onUpdate:modelValue":e[9]||(e[9]=n=>T.value=n),placeholder:"筛选条件",size:"small",style:{width:"120px"},onChange:mt,clearable:""},{default:s(()=>[t(C,{label:"订单号",value:"orderNo"}),t(C,{label:"学生姓名",value:"studentName"}),t(C,{label:"用餐方式",value:"diningType"}),t(C,{label:"订单金额",value:"total"}),t(C,{label:"下单日期",value:"date"})]),_:1},8,["modelValue"]),T.value==="date"?(i(),Y(Ut,{key:0,modelValue:$.value,"onUpdate:modelValue":e[10]||(e[10]=n=>$.value=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small",onChange:G,style:{width:"260px"},"value-format":"YYYY-MM-DD",shortcuts:Le},null,8,["modelValue"])):T.value==="orderNo"||T.value==="studentName"?(i(),Y(ve,{key:1,modelValue:S.value,"onUpdate:modelValue":e[11]||(e[11]=n=>S.value=n),placeholder:`请输入${T.value==="orderNo"?"订单号":"学生姓名"}`,size:"small",clearable:"",onInput:G,style:{width:"200px"}},null,8,["modelValue","placeholder"])):T.value==="diningType"?(i(),Y(K,{key:2,modelValue:S.value,"onUpdate:modelValue":e[12]||(e[12]=n=>S.value=n),placeholder:"选择用餐方式",size:"small",clearable:"",onChange:G,style:{width:"200px"}},{default:s(()=>[t(C,{label:"堂食",value:"堂食"}),t(C,{label:"外带",value:"外带"})]),_:1},8,["modelValue"])):T.value==="total"?(i(),f("div",fa,[t(oe,{modelValue:V.value.min,"onUpdate:modelValue":e[13]||(e[13]=n=>V.value.min=n),min:0,size:"small",placeholder:"最小金额",onChange:G},null,8,["modelValue"]),e[40]||(e[40]=l("span",null,"-",-1)),t(oe,{modelValue:V.value.max,"onUpdate:modelValue":e[14]||(e[14]=n=>V.value.max=n),min:0,size:"small",placeholder:"最大金额",onChange:G},null,8,["modelValue"])])):b("",!0),t(r,{type:"default",size:"small",onClick:yt,disabled:!ht.value},{default:s(()=>[t(o,null,{default:s(()=>[t(y(Ft))]),_:1}),e[41]||(e[41]=m(" 重置 "))]),_:1},8,["disabled"])])])]),l("div",_a,[l("div",ga,[t(O,{modelValue:ne.value,"onUpdate:modelValue":e[15]||(e[15]=n=>ne.value=n),"active-text":"自动接单",onChange:pt},null,8,["modelValue"]),ne.value?(i(),Y(K,{key:0,modelValue:be.value,"onUpdate:modelValue":e[16]||(e[16]=n=>be.value=n),placeholder:"提醒方式",size:"small",style:{width:"120px","margin-left":"10px"}},{default:s(()=>[t(C,{label:"声音提醒",value:"sound"}),t(C,{label:"桌面通知",value:"desktop"}),t(C,{label:"全部提醒",value:"all"})]),_:1},8,["modelValue"])):b("",!0)]),l("div",ya,[t(ee,{modelValue:ue.value,"onUpdate:modelValue":e[17]||(e[17]=n=>ue.value=n),indeterminate:Te.value,onChange:_t,class:"select-all-checkbox",value:!0},{default:s(()=>e[42]||(e[42]=[m(" 全选 ")])),_:1},8,["modelValue","indeterminate"]),t(r,{type:"primary",link:"",onClick:e[18]||(e[18]=n=>X.value=!0)},{default:s(()=>[t(o,null,{default:s(()=>[t(y(Ue))]),_:1}),e[43]||(e[43]=m(" 设置 "))]),_:1})])]),t(Bt,{modelValue:X.value,"onUpdate:modelValue":e[26]||(e[26]=n=>X.value=n),title:"自动接单设置",direction:"rtl",size:"90%","with-header":!0,class:"settings-drawer","modal-class":"settings-drawer-modal","append-to-body":!0},{header:s(()=>e[44]||(e[44]=[l("h4",{class:"drawer-title"},"自动接单设置",-1)])),footer:s(()=>[l("div",ba,[t(r,{onClick:e[25]||(e[25]=n=>X.value=!1)},{default:s(()=>e[48]||(e[48]=[m("取消")])),_:1}),t(r,{type:"primary",onClick:wt},{default:s(()=>e[49]||(e[49]=[m("保存")])),_:1})])]),default:s(()=>[l("div",ha,[t(jt,null,{default:s(()=>[t(ze,{"label-position":"top"},{default:s(()=>[t(x,{label:"接单时间范围"},{default:s(()=>[t(fe,{modelValue:z.value.timeRange,"onUpdate:modelValue":e[19]||(e[19]=n=>z.value.timeRange=n),"is-range":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"HH:mm",class:"full-width-input"},null,8,["modelValue"])]),_:1}),t(x,{label:"最大同时处理订单数"},{default:s(()=>[t(oe,{modelValue:z.value.maxOrders,"onUpdate:modelValue":e[20]||(e[20]=n=>z.value.maxOrders=n),min:1,max:20,class:"full-width-input"},null,8,["modelValue"])]),_:1}),t(x,{label:"自动拒单条件"},{default:s(()=>[t(Ye,{modelValue:z.value.rejectConditions,"onUpdate:modelValue":e[21]||(e[21]=n=>z.value.rejectConditions=n),class:"reject-conditions"},{default:s(()=>[t(ee,{value:"largeOrder",class:"condition-item"},{default:s(()=>e[45]||(e[45]=[m("订单金额超过限制")])),_:1}),t(ee,{value:"specialRequirement",class:"condition-item"},{default:s(()=>e[46]||(e[46]=[m("含有特殊要求")])),_:1}),t(ee,{value:"busyHours",class:"condition-item"},{default:s(()=>e[47]||(e[47]=[m("高峰时段")])),_:1})]),_:1},8,["modelValue"])]),_:1}),z.value.rejectConditions.includes("largeOrder")?(i(),Y(x,{key:0,label:"订单金额限制"},{default:s(()=>[t(oe,{modelValue:z.value.maxOrderAmount,"onUpdate:modelValue":e[22]||(e[22]=n=>z.value.maxOrderAmount=n),min:0,step:10,class:"full-width-input"},null,8,["modelValue"])]),_:1})):b("",!0),z.value.rejectConditions.includes("busyHours")?(i(),Y(x,{key:1,label:"高峰时段设置"},{default:s(()=>[t(Ot,{modelValue:z.value.busyHours,"onUpdate:modelValue":e[23]||(e[23]=n=>z.value.busyHours=n),"picker-options":{start:"08:00",step:"00:30",end:"20:00"},multiple:"",placeholder:"选择高峰时段",class:"full-width-input"},null,8,["modelValue"])]),_:1})):b("",!0),t(x,{label:"智能调节"},{default:s(()=>[l("div",wa,[t(O,{modelValue:z.value.smartAdjust,"onUpdate:modelValue":e[24]||(e[24]=n=>z.value.smartAdjust=n),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"]),z.value.smartAdjust?(i(),f("div",ka," 系统将根据历史数据自动调节接单参数 ")):b("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1},8,["modelValue"]),w.value.length>0?(i(),f("div",Ta,[l("span",xa,"已选择 "+u(w.value.length)+" 个订单",1),l("div",Ca,[t(W,{onCommand:ot},{dropdown:s(()=>[t(j,null,{default:s(()=>[t(M,{command:"print"},{default:s(()=>e[51]||(e[51]=[m("批量打印")])),_:1}),t(M,{command:"export"},{default:s(()=>e[52]||(e[52]=[m("导出订单")])),_:1}),t(M,{command:"delete",divided:"",style:{color:"#F56C6C"}},{default:s(()=>e[53]||(e[53]=[m(" 批量删除 ")])),_:1})]),_:1})]),default:s(()=>[t(r,{type:"primary",size:"small"},{default:s(()=>[e[50]||(e[50]=m(" 批量处理 ")),t(o,{class:"el-icon--right"},{default:s(()=>[t(y(he))]),_:1})]),_:1})]),_:1}),N.value==="pending"?(i(),Y(r,{key:0,type:"primary",size:"small",onClick:Ke},{default:s(()=>e[54]||(e[54]=[m(" 批量接单 ")])),_:1})):b("",!0),N.value==="processing"?(i(),Y(r,{key:1,type:"success",size:"small",onClick:et},{default:s(()=>e[55]||(e[55]=[m(" 批量完成 ")])),_:1})):b("",!0)])])):b("",!0),l("div",Va,[t(It,{gutter:10},{default:s(()=>[t(ge,{span:8},{default:s(()=>[l("div",Ma,[l("div",Da,u(le.value.orderCount),1),e[56]||(e[56]=l("div",{class:"stat-label"},"今日订单",-1))])]),_:1}),t(ge,{span:8},{default:s(()=>[l("div",Sa,[l("div",$a,"¥"+u(le.value.revenue),1),e[57]||(e[57]=l("div",{class:"stat-label"},"营业额",-1))])]),_:1}),t(ge,{span:8},{default:s(()=>[l("div",za,[l("div",Ya,u(le.value.avgTime)+"分钟",1),e[58]||(e[58]=l("div",{class:"stat-label"},"平均处理",-1))])]),_:1})]),_:1})]),l("div",Na,[t(Ye,{modelValue:w.value,"onUpdate:modelValue":e[27]||(e[27]=n=>w.value=n),onChange:at},{default:s(()=>[N.value==="completed"?(i(!0),f(I,{key:0},q(rt.value,n=>(i(),f("div",{key:n.date,class:"order-group"},[l("div",Aa,[l("span",Ua,u(n.date),1),l("span",Oa,u(n.orders.length)+"个订单",1)]),(i(!0),f(I,null,q(n.orders,c=>(i(),Y(Ne,{key:c.id,class:"order-card"},{default:s(()=>[l("div",ja,[l("div",Ba,[l("div",Ia,[l("div",Ha,[l("span",Pa,"订单号："+u(c.orderNo),1)]),t(v,{type:Ve(c.status)},{default:s(()=>[m(u(c.status),1)]),_:2},1032,["type"])]),c.expanded?(i(),f("div",Ea,[l("span",qa,u(Z(c.createTime)),1),t(v,{size:"small",type:c.diningType==="堂食"?"success":"warning",class:"dining-type"},{default:s(()=>[m(u(c.diningType),1)]),_:2},1032,["type"])])):b("",!0)]),t(r,{text:"",class:"expand-btn",onClick:D=>Me(c)},{default:s(()=>[m(u(c.expanded?"收起":"展开")+" ",1),t(o,{class:we(["expand-icon",{"is-expanded":c.expanded}])},{default:s(()=>[t(y(he))]),_:2},1032,["class"])]),_:2},1032,["onClick"])]),Be(l("div",null,[l("div",La,[t(o,null,{default:s(()=>[t(y(He))]),_:1}),l("span",null,u(c.studentName),1),l("span",Ra,"订单号："+u(c.orderNo),1)]),l("div",Fa,[l("div",Wa,[e[59]||(e[59]=l("span",null,"菜品明细",-1)),l("span",null,"共"+u(Ce(c.items))+"份",1)]),l("div",Qa,[(i(!0),f(I,null,q(c.items,D=>(i(),f("div",{key:D.id,class:"order-item"},[D.name!=="米饭"?(i(),f("div",Ja,[l("img",{src:De(D.name),alt:D.name},null,8,Xa)])):b("",!0),l("div",Za,[l("div",Ga,[l("span",Ka,u(D.name),1)]),D.specs?(i(),f("div",el,u(D.specs),1)):b("",!0),l("div",tl,[l("span",al,"x"+u(D.quantity),1),l("span",ll,"¥"+u(D.price),1)])])]))),128))])]),l("div",sl,[l("div",nl,[l("div",ol,[e[60]||(e[60]=l("span",{class:"total-label"},"总计：",-1)),l("span",il,"¥"+u(c.total),1)]),c.remark?(i(),f("div",dl,[t(o,null,{default:s(()=>[t(y(Pe))]),_:1}),l("span",null,u(c.remark),1)])):b("",!0)]),l("div",ul,[t(r,{type:"primary",size:"small",onClick:D=>Se(c),class:"print-btn"},{default:s(()=>[t(o,null,{default:s(()=>[t(y(Ee))]),_:1}),e[61]||(e[61]=m(" 打印 "))]),_:2},1032,["onClick"])])])],512),[[Ie,c.expanded]])]),_:2},1024))),128))]))),128)):(i(!0),f(I,{key:1},q(h.value,n=>(i(),Y(Ne,{key:n.id,class:we(["order-card",{"new-order":n.isNew}])},{default:s(()=>[l("div",rl,[l("div",cl,[l("div",ml,[l("div",pl,[We(n)?(i(),Y(ee,{key:0,value:n.id},{default:s(()=>[l("span",vl,"订单号："+u(n.orderNo),1)]),_:2},1032,["value"])):(i(),f("span",fl,"订单号："+u(n.orderNo),1))]),t(v,{type:Ve(n.status)},{default:s(()=>[m(u(n.status),1)]),_:2},1032,["type"])]),n.expanded?(i(),f("div",_l,[l("span",gl,u(Z(n.createTime)),1),t(v,{size:"small",type:n.diningType==="堂食"?"success":"warning",class:"dining-type"},{default:s(()=>[m(u(n.diningType),1)]),_:2},1032,["type"])])):b("",!0)]),t(r,{text:"",class:"expand-btn",onClick:c=>Me(n)},{default:s(()=>[m(u(n.expanded?"收起":"展开")+" ",1),t(o,{class:we(["expand-icon",{"is-expanded":n.expanded}])},{default:s(()=>[t(y(he))]),_:2},1032,["class"])]),_:2},1032,["onClick"])]),Be(l("div",null,[l("div",yl,[t(o,null,{default:s(()=>[t(y(He))]),_:1}),l("span",null,u(n.studentName),1),l("span",hl,"("+u(n.studentId)+")",1)]),l("div",wl,[l("div",kl,[e[62]||(e[62]=l("span",null,"菜品明细",-1)),l("span",null,"共"+u(Ce(n.items))+"份",1)]),l("div",bl,[(i(!0),f(I,null,q(n.items,c=>(i(),f("div",{key:c.id,class:"order-item"},[c.name!=="米饭"?(i(),f("div",Tl,[l("img",{src:De(c.name),alt:c.name},null,8,xl)])):b("",!0),l("div",Cl,[l("div",Vl,[l("span",Ml,u(c.name),1)]),c.specs?(i(),f("div",Dl,u(c.specs),1)):b("",!0),l("div",Sl,[l("span",$l,"x"+u(c.quantity),1),l("span",zl,"¥"+u(c.price),1)])])]))),128))])]),l("div",Yl,[l("div",Nl,[l("div",Al,[e[63]||(e[63]=l("span",{class:"total-label"},"总计：",-1)),l("span",Ul,"¥"+u(n.total),1)]),n.remark?(i(),f("div",Ol,[t(o,null,{default:s(()=>[t(y(Pe))]),_:1}),l("span",null,u(n.remark),1)])):b("",!0)]),l("div",jl,[n.status==="待处理"?(i(),f(I,{key:0},[t(r,{type:"primary",size:"small",onClick:c=>Xe(n)},{default:s(()=>e[64]||(e[64]=[m(" 接单 ")])),_:2},1032,["onClick"]),t(r,{type:"danger",size:"small",onClick:c=>Ze(n)},{default:s(()=>e[65]||(e[65]=[m(" 拒绝 ")])),_:2},1032,["onClick"])],64)):n.status==="进行中"?(i(),Y(r,{key:1,type:"success",size:"small",onClick:c=>Ge(n)},{default:s(()=>e[66]||(e[66]=[m(" 完成 ")])),_:2},1032,["onClick"])):b("",!0),t(r,{type:"primary",size:"small",onClick:c=>Se(n),class:"print-btn"},{default:s(()=>[t(o,null,{default:s(()=>[t(y(Ee))]),_:1}),e[67]||(e[67]=m(" 打印 "))]),_:2},1032,["onClick"])])])],512),[[Ie,n.expanded]])]),_:2},1032,["class"]))),128))]),_:1},8,["modelValue"])]),l("div",Bl,[t(Ht,{"current-page":H.value,"onUpdate:currentPage":e[28]||(e[28]=n=>H.value=n),"page-size":F.value,"onUpdate:pageSize":e[29]||(e[29]=n=>F.value=n),"page-sizes":[10,20,30,50],total:se.value,layout:"total, sizes, prev, pager, next",onSizeChange:Qe,onCurrentChange:Je},null,8,["current-page","page-size","total"])]),L.value||te.value?(i(),f("div",Il,[L.value?(i(),f("p",Hl,"加载中...")):b("",!0),te.value?(i(),f("p",Pl,"没有更多订单了")):b("",!0)])):b("",!0)])}}},Fl=Qt(El,[["__scopeId","data-v-ee8cd60a"]]);export{Fl as default};
