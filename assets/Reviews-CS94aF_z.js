import{m as d,S as z,o as le,q as r,t as a,D as i,b as c,J as h,L as y,w as m,e as p,a as n,ax as oe,c as T,y as k,M as B,u as P,a4 as ne,aa as ie,d as Y,F as re,U as R}from"./vendor-DLSupzTO.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"mobile-reviews"},ue={class:"stats-section"},ve={class:"overall-rating"},me={class:"rating-score"},_e={class:"score"},pe={class:"rating-stars"},fe={class:"rating-distribution"},ge=["onClick"],he={class:"star-label"},ye={class:"progress-bar"},Me={class:"percentage"},be={class:"tag-filter"},ke={class:"tag-group"},Ce={class:"tag-count"},Re={class:"filter-toolbar"},ze={class:"filter-group"},Ye={class:"filter-type-tags"},De=["onClick"],Te={class:"date-filter-group"},Ve={class:"reviews-list"},we={class:"review-header"},Se={class:"user-info"},Fe={class:"avatar-wrapper"},Ne={class:"user-name"},xe={class:"user-details"},Ue={class:"rating-time"},Be={class:"review-time"},Pe={class:"order-info"},$e={class:"order-id"},Ae={class:"review-content"},Ee={class:"dishes-list"},Ie=["src","alt"],Oe={class:"dish-info"},je={class:"dish-name"},He={class:"dish-price"},Je={class:"review-text"},Le={key:0,class:"review-images"},qe={class:"image-error"},Ge={key:1,class:"review-tags"},Ke={key:0,class:"review-reply"},Qe={class:"reply-header"},We={class:"reply-time"},Xe={class:"reply-content"},Ze={key:1,class:"review-actions"},et={class:"pagination-container"},tt={__name:"Reviews",setup(at){const $=re();d("all");const v=d(""),M=d(""),f=d(null),g=d(1),C=d(10),V=d(0),w=d([]),D=d({avgRating:4.5,totalReviews:128,positiveRate:92}),A=d([{stars:5,count:80,percentage:62.5},{stars:4,count:30,percentage:23.4},{stars:3,count:10,percentage:7.8},{stars:2,count:5,percentage:3.9},{stars:1,count:3,percentage:2.4}]),b=d([{name:"全部",count:128,active:!0},{name:"味道好",count:86,active:!1},{name:"分量足",count:45,active:!1},{name:"服务好",count:38,active:!1},{name:"价格实惠",count:32,active:!1},{name:"环境好",count:28,active:!1},{name:"出餐快",count:25,active:!1}]),E=[{label:"全部评价",value:""},{label:"未回复",value:"unreplied"},{label:"已回复",value:"replied"},{label:"有图评价",value:"withPhotos"}],I=z(()=>!!(v.value||M.value||f.value||b.value.some(t=>t.active&&t.name!=="全部"))),O=t=>({5:"#ff9c00",4:"#ffb340",3:"#ffc773",2:"#ffd9a6",1:"#ffe6cc"})[t]||"#ff9c00",j=t=>{v.value="rating",M.value=t.toString(),_()},H=t=>{if(t.name==="全部")b.value.forEach(s=>s.active=s===t);else{const s=b.value.find(l=>l.name==="全部");s&&(s.active=!1),t.active=!t.active}_()},J=()=>{const t=[],s=[{id:1,name:"红烧肉",price:15,image:"https://img.zcool.cn/community/01a9445d54c65da801211d53235317.jpg"},{id:2,name:"宫保鸡丁",price:16,image:"https://img.zcool.cn/community/01f8c65d54c65da801211d532386f7.jpg"}];for(let l=0;l<20;l++){const u=s.slice(0,Math.floor(Math.random()*2)+1);t.push({id:l+1,orderId:`ORDER${String(Math.floor(Math.random()*1e6)).padStart(6,"0")}`,userName:["张三","李四","王五","赵六"][Math.floor(Math.random()*4)],userAvatar:"",rating:Math.floor(Math.random()*3)+3,content:["很好吃，下次还会来！","份量足，味道不错","服务态度很好，菜品口感不错","价格实惠，推荐"][Math.floor(Math.random()*4)],createTime:R().subtract(Math.floor(Math.random()*7),"day").valueOf(),dishes:u,images:Math.random()>.5?[u[0].image]:[],tags:["味道好","分量足","服务好"].slice(0,Math.floor(Math.random()*3)+1),reply:Math.random()>.7?"感谢您的评价，我们会继续努力！":"",replyTime:R().subtract(Math.floor(Math.random()*2),"day").valueOf()})}return t},S=z(()=>{let t=[...w.value];v.value==="rating"&&M.value&&(t=t.filter(l=>l.rating===Number(M.value))),v.value==="unreplied"?t=t.filter(l=>!l.reply):v.value==="replied"?t=t.filter(l=>l.reply):v.value==="withPhotos"&&(t=t.filter(l=>l.images&&l.images.length>0));const s=b.value.filter(l=>l.active&&l.name!=="全部").map(l=>l.name);if(s.length>0&&(t=t.filter(l=>l.tags.some(u=>s.includes(u)))),f.value){const l=R(f.value).format("YYYY-MM-DD");t=t.filter(u=>R(u.createTime).format("YYYY-MM-DD")===l)}return t}),L=z(()=>{const t=(g.value-1)*C.value,s=t+C.value;return S.value.slice(t,s)}),q=z(()=>S.value.length),G=()=>{g.value=1,M.value="",f.value=null,_()},K=()=>{g.value=1,_()},Q=()=>{v.value="",M.value="",f.value=null,g.value=1,b.value.forEach(t=>{t.active=t.name==="全部"}),_()},W=t=>{C.value=t,_()},X=t=>{g.value=t,_()},Z=t=>{localStorage.setItem("current_review",JSON.stringify(t)),$.push({name:"review-reply",params:{id:t.id}})},_=async()=>{w.value=J(),V.value=q.value},F=t=>R(t).format("YYYY-MM-DD HH:mm");return le(()=>{_()}),(t,s)=>{const l=p("el-rate"),u=p("el-tag"),ee=p("el-date-picker"),N=p("el-icon"),x=p("el-button"),te=p("el-avatar"),ae=p("el-image"),se=p("el-pagination");return n(),r("div",de,[a("div",ue,[a("div",ve,[a("div",me,[a("span",_e,i(D.value.avgRating.toFixed(1)),1),s[4]||(s[4]=a("span",{class:"total"},"/ 5.0",-1))]),a("div",pe,[c(l,{modelValue:D.value.avgRating,"onUpdate:modelValue":s[0]||(s[0]=e=>D.value.avgRating=e),disabled:"","allow-half":"",colors:["#ffd21e","#ffd21e","#ffd21e"]},null,8,["modelValue"])]),s[5]||(s[5]=a("div",{class:"rating-text"},"总体评分",-1))]),a("div",fe,[(n(!0),r(h,null,y(A.value,(e,o)=>(n(),r("div",{key:o,class:"distribution-item",onClick:U=>j(5-o)},[a("span",he,i(5-o)+"星",1),a("div",ye,[a("div",{class:"progress",style:oe({width:e.percentage+"%",backgroundColor:O(5-o)})},null,4)]),a("span",Me,i(e.percentage)+"%",1)],8,ge))),128))])]),a("div",be,[a("div",ke,[(n(!0),r(h,null,y(b.value,e=>(n(),T(u,{key:e.name,type:e.active?"warning":"info",class:B(["filter-tag",{active:e.active}]),onClick:o=>H(e)},{default:m(()=>[k(i(e.name)+" ",1),a("span",Ce,"("+i(e.count)+")",1)]),_:2},1032,["type","class","onClick"]))),128))])]),a("div",Re,[a("div",ze,[a("div",Ye,[(n(),r(h,null,y(E,e=>a("div",{key:e.value,class:B(["filter-type-tag",{active:v.value===e.value}]),onClick:o=>{v.value=e.value,G()}},i(e.label),11,De)),64))]),a("div",Te,[c(ee,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=e=>f.value=e),type:"date",placeholder:"选择日期",size:"small",clearable:!0,"value-format":"YYYY-MM-DD",onChange:K},null,8,["modelValue"]),c(x,{type:"default",size:"small",onClick:Q,disabled:!I.value},{default:m(()=>[c(N,null,{default:m(()=>[c(P(ne))]),_:1}),s[6]||(s[6]=k(" 重置 "))]),_:1},8,["disabled"])])])]),a("div",Ve,[(n(!0),r(h,null,y(L.value,e=>(n(),r("div",{key:e.id,class:"review-item"},[a("div",we,[a("div",Se,[a("div",Fe,[c(te,{size:36,src:e.userAvatar},{default:m(()=>[k(i(e.userName.charAt(0)),1)]),_:2},1032,["src"]),a("span",Ne,i(e.userName),1)]),a("div",xe,[a("div",Ue,[c(l,{modelValue:e.rating,"onUpdate:modelValue":o=>e.rating=o,disabled:"",colors:["#ffd21e","#ffd21e","#ffd21e"],size:"small"},null,8,["modelValue","onUpdate:modelValue"]),a("span",Be,i(F(e.createTime)),1)])])]),a("div",Pe,[a("span",$e,"订单号："+i(e.orderId),1)])]),a("div",Ae,[a("div",Ee,[(n(!0),r(h,null,y(e.dishes,o=>(n(),r("div",{key:o.id,class:"dish-item"},[a("img",{src:o.image,alt:o.name,class:"dish-image"},null,8,Ie),a("div",Oe,[a("span",je,i(o.name),1),a("span",He,"¥"+i(o.price),1)])]))),128))]),a("p",Je,i(e.content),1),e.images&&e.images.length?(n(),r("div",Le,[(n(!0),r(h,null,y(e.images,(o,U)=>(n(),T(ae,{key:U,src:o,"preview-src-list":e.images,fit:"cover",class:"review-image"},{error:m(()=>[a("div",qe,[c(N,null,{default:m(()=>[c(P(ie))]),_:1})])]),_:2},1032,["src","preview-src-list"]))),128))])):Y("",!0),e.tags&&e.tags.length?(n(),r("div",Ge,[(n(!0),r(h,null,y(e.tags,o=>(n(),T(u,{key:o,size:"small",type:"info",class:"review-tag"},{default:m(()=>[k(i(o),1)]),_:2},1024))),128))])):Y("",!0)]),e.reply?(n(),r("div",Ke,[a("div",Qe,[c(u,{size:"small",type:"success"},{default:m(()=>s[7]||(s[7]=[k("商家回复")])),_:1}),a("span",We,i(F(e.replyTime)),1)]),a("p",Xe,i(e.reply),1)])):Y("",!0),e.reply?Y("",!0):(n(),r("div",Ze,[c(x,{type:"primary",plain:"",size:"small",onClick:o=>Z(e)},{default:m(()=>s[8]||(s[8]=[k(" 回复评价 ")])),_:2},1032,["onClick"])]))]))),128))]),a("div",et,[c(se,{"current-page":g.value,"onUpdate:currentPage":s[2]||(s[2]=e=>g.value=e),"page-size":C.value,"onUpdate:pageSize":s[3]||(s[3]=e=>C.value=e),"page-sizes":[10,20,30,50],total:V.value,layout:"total, sizes, prev, pager, next",onSizeChange:W,onCurrentChange:X},null,8,["current-page","page-size","total"])])])}}},ot=ce(tt,[["__scopeId","data-v-9ead58b7"]]);export{ot as default};
