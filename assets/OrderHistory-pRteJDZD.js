import{m as p,J as L,q as _,t as e,b as l,w as d,u as M,N as b,O as V,e as i,a as c,ae as G,y as T,D as a,c as K,d as N,F as P,$ as f}from"./vendor-qvz31vGP.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"order-history"},X={class:"page-header"},Z={class:"filter-toolbar"},tt={class:"stats-cards"},et={class:"stat-card"},st={class:"stat-value"},at={class:"stat-card"},ot={class:"stat-value"},lt={class:"stat-card"},nt={class:"stat-value"},dt={class:"history-list"},rt={class:"date-header"},it={class:"date-text"},ct={class:"order-count"},ut={class:"order-card-header"},_t={class:"order-basic-info"},vt={class:"order-info"},mt={class:"order-no"},pt={class:"order-meta"},ft={class:"order-time"},ht={class:"order-amount"},yt={key:0,class:"detail-content"},gt={class:"detail-section"},Dt={class:"detail-item"},kt={class:"value"},bt={class:"detail-item"},Vt={class:"value"},Tt={class:"detail-item"},wt={class:"value"},Ot={class:"detail-section"},Yt={class:"order-items"},xt={class:"item-info"},Ct={class:"item-name"},Mt={class:"item-quantity"},Nt={class:"item-price"},Rt={class:"order-total"},St={class:"total-price"},Ht={key:0,class:"detail-section"},qt={class:"order-remark"},Bt={__name:"OrderHistory",setup(Ft){const R=P(),m=p([]),h=p(""),g=p(!1),r=p(null),S=[{text:"最近一周",value:()=>{const s=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*7),[t,s]}},{text:"最近一月",value:()=>{const s=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*30),[t,s]}}],y=p({totalOrders:0,totalRevenue:0,completionRate:0}),H=p([{id:1,orderNo:"DD20240320001",status:"已完成",createTime:"2024-03-20 14:30:00",total:35.5,items:[{id:1,name:"红烧肉",quantity:1,price:15},{id:2,name:"米饭",quantity:1,price:2}],remark:"不要辣"}]),w=L(()=>{const s=H.value.filter(n=>{if(h.value&&n.status!==h.value)return!1;if(m.value&&m.value.length===2){const u=f(n.createTime);return u.isAfter(m.value[0])&&u.isBefore(m.value[1])}return!0}),t={};return s.forEach(n=>{const u=f(n.createTime).format("YYYY-MM-DD");t[u]||(t[u]={orders:[]}),t[u].orders.push(n)}),t}),q=s=>{const t=f().startOf("day"),n=f(s);return n.isSame(t,"day")?"今天":n.isSame(t.subtract(1,"day"),"day")?"昨天":n.format("YYYY年MM月DD日")},B=s=>f(s).format("HH:mm:ss"),F=s=>f(s).format("YYYY-MM-DD HH:mm:ss"),O=s=>({已完成:"success",已取消:"info"})[s]||"default",U=()=>{D()},$=()=>{D()},j=s=>{r.value=s,g.value=!0},D=()=>{const s=Object.values(w.value).flatMap(t=>t.orders);y.value={totalOrders:s.length,totalRevenue:s.reduce((t,n)=>t+n.total,0).toFixed(2),completionRate:Math.round(s.filter(t=>t.status==="已完成").length/s.length*100)||0}};return D(),(s,t)=>{const n=i("el-icon"),u=i("el-button"),z=i("el-date-picker"),Y=i("el-option"),E=i("el-select"),k=i("el-col"),A=i("el-row"),x=i("el-tag"),I=i("el-card"),J=i("el-dialog");return c(),_("div",W,[e("div",X,[l(u,{link:"",onClick:t[0]||(t[0]=o=>M(R).back())},{default:d(()=>[l(n,null,{default:d(()=>[l(M(G))]),_:1}),t[4]||(t[4]=T(" 返回 "))]),_:1}),t[5]||(t[5]=e("span",{class:"header-title"},"历史订单",-1)),t[6]||(t[6]=e("div",{style:{width:"40px"}},null,-1))]),e("div",Z,[l(z,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small",shortcuts:S,onChange:U},null,8,["modelValue"]),l(E,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=o=>h.value=o),placeholder:"订单状态",size:"small",clearable:"",onChange:$},{default:d(()=>[l(Y,{label:"已完成",value:"completed"}),l(Y,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),e("div",tt,[l(A,{gutter:10},{default:d(()=>[l(k,{span:8},{default:d(()=>[e("div",et,[e("div",st,a(y.value.totalOrders),1),t[7]||(t[7]=e("div",{class:"stat-label"},"总订单数",-1))])]),_:1}),l(k,{span:8},{default:d(()=>[e("div",at,[e("div",ot,"¥"+a(y.value.totalRevenue),1),t[8]||(t[8]=e("div",{class:"stat-label"},"总收入",-1))])]),_:1}),l(k,{span:8},{default:d(()=>[e("div",lt,[e("div",nt,a(y.value.completionRate)+"%",1),t[9]||(t[9]=e("div",{class:"stat-label"},"完成率",-1))])]),_:1})]),_:1})]),e("div",dt,[(c(!0),_(b,null,V(w.value,(o,C)=>(c(),_("div",{key:C,class:"order-group"},[e("div",rt,[e("span",it,a(q(C)),1),e("span",ct,a(o.orders.length)+"个订单",1)]),(c(!0),_(b,null,V(o.orders,v=>(c(),K(I,{key:v.id,class:"order-card",onClick:Ut=>j(v)},{default:d(()=>[e("div",ut,[e("div",_t,[e("div",vt,[e("span",mt,"订单号："+a(v.orderNo),1),l(x,{type:O(v.status)},{default:d(()=>[T(a(v.status),1)]),_:2},1032,["type"])]),e("div",pt,[e("span",ft,a(B(v.createTime)),1),e("span",ht,"¥"+a(v.total),1)])])])]),_:2},1032,["onClick"]))),128))]))),128))]),l(J,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=o=>g.value=o),title:"订单详情",width:"90%",class:"detail-dialog"},{default:d(()=>[r.value?(c(),_("div",yt,[e("div",gt,[t[13]||(t[13]=e("div",{class:"section-title"},"基本信息",-1)),e("div",Dt,[t[10]||(t[10]=e("span",{class:"label"},"订单号",-1)),e("span",kt,a(r.value.orderNo),1)]),e("div",bt,[t[11]||(t[11]=e("span",{class:"label"},"下单时间",-1)),e("span",Vt,a(F(r.value.createTime)),1)]),e("div",Tt,[t[12]||(t[12]=e("span",{class:"label"},"订单状态",-1)),e("span",wt,[l(x,{type:O(r.value.status)},{default:d(()=>[T(a(r.value.status),1)]),_:1},8,["type"])])])]),e("div",Ot,[t[15]||(t[15]=e("div",{class:"section-title"},"菜品信息",-1)),e("div",Yt,[(c(!0),_(b,null,V(r.value.items,o=>(c(),_("div",{key:o.id,class:"order-item"},[e("div",xt,[e("span",Ct,a(o.name),1),e("span",Mt,"x"+a(o.quantity),1)]),e("span",Nt,"¥"+a(o.price),1)]))),128))]),e("div",Rt,[t[14]||(t[14]=e("span",null,"总计",-1)),e("span",St,"¥"+a(r.value.total),1)])]),r.value.remark?(c(),_("div",Ht,[t[16]||(t[16]=e("div",{class:"section-title"},"备注",-1)),e("div",qt,a(r.value.remark),1)])):N("",!0)])):N("",!0)]),_:1},8,["modelValue"])])}}},zt=Q(Bt,[["__scopeId","data-v-0ef1c208"]]);export{zt as default};
